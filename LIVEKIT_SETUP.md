# LiveKit éŸ³é¢‘æˆ¿é—´é…ç½®æŒ‡å—

æœ¬é¡¹ç›®å·²é›†æˆ LiveKit å®æ—¶éŸ³é¢‘é€šä¿¡åŠŸèƒ½ï¼Œæ”¯æŒå¤šäººè¯­éŸ³èŠå¤©ã€éº¦å…‹é£æ§åˆ¶ã€æ‰¬å£°å™¨æ§åˆ¶ç­‰åŠŸèƒ½ã€‚

## ğŸ“‹ åŠŸèƒ½ç‰¹æ€§

- âœ… å®æ—¶éŸ³é¢‘é€šä¿¡
- âœ… éº¦å…‹é£å¼€å…³æ§åˆ¶
- âœ… æ‰¬å£°å™¨é™éŸ³æ§åˆ¶
- âœ… éŸ³é¢‘è®¾å¤‡åˆ‡æ¢
- âœ… éŸ³é¢‘è´¨é‡é€‰æ‹©ï¼ˆé«˜æ¸…/æ ‡å‡†/çœæµï¼‰
- âœ… å‚ä¸è€…åˆ—è¡¨æ˜¾ç¤º
- âœ… è¯´è¯çŠ¶æ€å®æ—¶æ˜¾ç¤º
- âœ… éŸ³é¢‘çº§åˆ«å¯è§†åŒ–
- âœ… è¿æ¥çŠ¶æ€ç›‘æ§
- âœ… è‡ªåŠ¨é‡è¿æœºåˆ¶

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. è·å– LiveKit å‡­è¯

æœ‰ä¸¤ç§æ–¹å¼è·å– LiveKit æœåŠ¡ï¼š

#### æ–¹å¼ä¸€ï¼šä½¿ç”¨ LiveKit Cloudï¼ˆæ¨èç”¨äºç”Ÿäº§ç¯å¢ƒï¼‰

1. è®¿é—® [https://cloud.livekit.io/](https://cloud.livekit.io/)
2. æ³¨å†Œå¹¶ç™»å½•è´¦å·
3. åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®
4. åœ¨é¡¹ç›®è®¾ç½®ä¸­è·å–ï¼š
   - WebSocket URL (ä¾‹å¦‚: `wss://your-project.livekit.cloud`)
   - API Key
   - API Secret

#### æ–¹å¼äºŒï¼šæœ¬åœ°éƒ¨ç½² LiveKit Serverï¼ˆæ¨èç”¨äºå¼€å‘ç¯å¢ƒï¼‰

```bash
# ä½¿ç”¨ Docker å¿«é€Ÿå¯åŠ¨ LiveKit Server
docker run --rm -p 7880:7880 \
  -p 7881:7881 \
  -p 7882:7882/udp \
  -e LIVEKIT_KEYS="devkey: secret" \
  livekit/livekit-server \
  --dev
```

æœ¬åœ°éƒ¨ç½²åçš„é…ç½®ï¼š
- WebSocket URL: `ws://localhost:7880`
- API Key: `devkey`
- API Secret: `secret`

### 2. é…ç½®ç¯å¢ƒå˜é‡

åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `.env.local` æ–‡ä»¶ï¼š

```bash
# LiveKit é…ç½®
LIVEKIT_URL=wss://your-project.livekit.cloud
LIVEKIT_API_KEY=your-api-key
LIVEKIT_API_SECRET=your-api-secret
```

**æ³¨æ„ï¼š**
- `LIVEKIT_URL` å¿…é¡»ä»¥ `NEXT_PUBLIC_` å¼€å¤´ï¼Œå› ä¸ºå®ƒä¼šåœ¨å®¢æˆ·ç«¯ä½¿ç”¨
- `LIVEKIT_API_KEY` å’Œ `LIVEKIT_API_SECRET` ä»…åœ¨æœåŠ¡ç«¯ä½¿ç”¨ï¼Œä¸ä¼šæš´éœ²åˆ°å®¢æˆ·ç«¯

### 3. å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
npm run dev
```

### 4. æµ‹è¯•éŸ³é¢‘æˆ¿é—´

1. æ‰“å¼€æµè§ˆå™¨è®¿é—® `http://localhost:3000/chat`
2. ç‚¹å‡»é¡µé¢å³ä¸Šè§’çš„"æ‰“å¼€è¯­éŸ³æˆ¿"æŒ‰é’®
3. ç‚¹å‡»"åŠ å…¥æˆ¿é—´"æŒ‰é’®
4. å…è®¸æµè§ˆå™¨è®¿é—®éº¦å…‹é£æƒé™
5. ç‚¹å‡»éº¦å…‹é£æŒ‰é’®å¼€å§‹è¯´è¯

## ğŸ¯ ä½¿ç”¨è¯´æ˜

### åŸºæœ¬æ“ä½œ

1. **åŠ å…¥æˆ¿é—´**
   - ç‚¹å‡»"æ‰“å¼€è¯­éŸ³æˆ¿"æŒ‰é’®æ˜¾ç¤ºè¯­éŸ³æˆ¿é—´é¢æ¿
   - ç‚¹å‡»"åŠ å…¥æˆ¿é—´"æŒ‰é’®è¿æ¥åˆ° LiveKit æœåŠ¡å™¨
   - é¦–æ¬¡ä½¿ç”¨éœ€è¦æˆäºˆéº¦å…‹é£æƒé™

2. **éº¦å…‹é£æ§åˆ¶**
   - è“è‰²éº¦å…‹é£å›¾æ ‡ï¼šéº¦å…‹é£å·²å¼€å¯
   - ç°è‰²éº¦å…‹é£å›¾æ ‡ï¼šéº¦å…‹é£å·²å…³é—­
   - ç‚¹å‡»éº¦å…‹é£æŒ‰é’®åˆ‡æ¢çŠ¶æ€

3. **æ‰¬å£°å™¨æ§åˆ¶**
   - ç»¿è‰²æ‰¬å£°å™¨å›¾æ ‡ï¼šå¯ä»¥å¬åˆ°å…¶ä»–äººçš„å£°éŸ³
   - ç°è‰²æ‰¬å£°å™¨å›¾æ ‡ï¼šé™éŸ³æ‰€æœ‰å…¶ä»–äºº
   - ç‚¹å‡»æ‰¬å£°å™¨æŒ‰é’®åˆ‡æ¢çŠ¶æ€

4. **ç¦»å¼€æˆ¿é—´**
   - ç‚¹å‡»çº¢è‰²æŒ‚æ–­æŒ‰é’®æ–­å¼€è¿æ¥
   - æˆ–ç‚¹å‡»"å…³é—­è¯­éŸ³æˆ¿"æŒ‰é’®éšè—é¢æ¿

### é«˜çº§åŠŸèƒ½

1. **åˆ‡æ¢éŸ³é¢‘è®¾å¤‡**
   - å¦‚æœæœ‰å¤šä¸ªéº¦å…‹é£ï¼Œå¯ä»¥åœ¨ä¸‹æ‹‰èœå•ä¸­é€‰æ‹©
   - ç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æµ‹å¯ç”¨çš„éŸ³é¢‘è¾“å…¥è®¾å¤‡

2. **è°ƒæ•´éŸ³é¢‘è´¨é‡**
   - **çœæµæ¨¡å¼**ï¼š32kbpsï¼Œé€‚åˆç½‘ç»œè¾ƒå·®æ—¶ä½¿ç”¨
   - **æ ‡å‡†æ¨¡å¼**ï¼š64kbpsï¼Œé»˜è®¤æ¨¡å¼ï¼Œå¹³è¡¡è´¨é‡å’Œå¸¦å®½
   - **é«˜æ¸…æ¨¡å¼**ï¼š128kbpsï¼Œé€‚åˆéŸ³ä¹ã€æ’­å®¢ç­‰é«˜è´¨é‡åœºæ™¯

3. **æŸ¥çœ‹å‚ä¸è€…**
   - å‚ä¸è€…åˆ—è¡¨å®æ—¶æ˜¾ç¤ºæ‰€æœ‰åœ¨çº¿ç”¨æˆ·
   - æ­£åœ¨è¯´è¯çš„ç”¨æˆ·ä¼šæœ‰è“è‰²é«˜äº®å’ŒåŠ¨ç”»æ•ˆæœ
   - å¯ä»¥çœ‹åˆ°æ¯ä¸ªç”¨æˆ·çš„éº¦å…‹é£çŠ¶æ€

## ğŸ”§ æŠ€æœ¯æ¶æ„

### æ ¸å¿ƒç»„ä»¶

1. **VoiceRoom ç»„ä»¶** (`src/components/VoiceRoom.tsx`)
   - è´Ÿè´£éŸ³é¢‘æˆ¿é—´çš„UIå’Œäº¤äº’é€»è¾‘
   - ç®¡ç† LiveKit Room å®ä¾‹
   - å¤„ç†éŸ³é¢‘è®¾å¤‡å’Œæƒé™

2. **LiveKit é…ç½®** (`src/lib/livekit.ts`)
   - å­˜å‚¨ LiveKit é…ç½®å¸¸é‡
   - æä¾›å·¥å…·å‡½æ•°ï¼ˆæˆ¿é—´åç§°ç”Ÿæˆã€éªŒè¯ç­‰ï¼‰
   - å®šä¹‰éŸ³é¢‘è´¨é‡é¢„è®¾

3. **Token API** (`src/app/api/livekit/token/route.ts`)
   - ç”Ÿæˆ LiveKit è®¿é—®ä»¤ç‰Œ
   - éªŒè¯è¯·æ±‚å‚æ•°
   - æˆäºˆæˆ¿é—´æƒé™

### æ•°æ®æµ

```
ç”¨æˆ·ç‚¹å‡»"åŠ å…¥æˆ¿é—´"
  â†“
å‰ç«¯è¯·æ±‚ /api/livekit/token
  â†“
æœåŠ¡ç«¯ç”Ÿæˆ JWT token
  â†“
å‰ç«¯ä½¿ç”¨ token è¿æ¥ LiveKit Server
  â†“
å»ºç«‹ WebRTC è¿æ¥
  â†“
å¼€å§‹éŸ³é¢‘é€šä¿¡
```

## ğŸ› å¸¸è§é—®é¢˜

### 1. æ— æ³•è¿æ¥åˆ°æˆ¿é—´

**é—®é¢˜ï¼š** ç‚¹å‡»"åŠ å…¥æˆ¿é—´"åä¸€ç›´æ˜¾ç¤º"è¿æ¥ä¸­..."

**è§£å†³æ–¹æ¡ˆï¼š**
- æ£€æŸ¥ `.env.local` æ–‡ä»¶æ˜¯å¦æ­£ç¡®é…ç½®
- ç¡®è®¤ LiveKit Server æ˜¯å¦æ­£å¸¸è¿è¡Œ
- æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯
- å¦‚æœä½¿ç”¨ LiveKit Cloudï¼Œç¡®è®¤ WebSocket URL æ ¼å¼æ­£ç¡®ï¼ˆä»¥ `wss://` å¼€å¤´ï¼‰

### 2. éº¦å…‹é£æƒé™è¢«æ‹’ç»

**é—®é¢˜ï¼š** æç¤º"éº¦å…‹é£æƒé™è¢«æ‹’ç»"

**è§£å†³æ–¹æ¡ˆï¼š**
- ç‚¹å‡»æµè§ˆå™¨åœ°å€æ çš„é”å›¾æ ‡
- æ‰¾åˆ°"éº¦å…‹é£"æƒé™è®¾ç½®
- é€‰æ‹©"å…è®¸"
- åˆ·æ–°é¡µé¢é‡è¯•

### 3. å¬ä¸åˆ°å…¶ä»–äººçš„å£°éŸ³

**é—®é¢˜ï¼š** å¯ä»¥çœ‹åˆ°å…¶ä»–äººåœ¨è¯´è¯ï¼Œä½†å¬ä¸åˆ°å£°éŸ³

**è§£å†³æ–¹æ¡ˆï¼š**
- æ£€æŸ¥æ‰¬å£°å™¨æŒ‰é’®æ˜¯å¦ä¸ºç»¿è‰²ï¼ˆæœªé™éŸ³ï¼‰
- ç¡®è®¤ç³»ç»ŸéŸ³é‡æœªé™éŸ³
- æ£€æŸ¥æµè§ˆå™¨æ˜¯å¦å…è®¸è‡ªåŠ¨æ’­æ”¾éŸ³é¢‘
- å°è¯•ç‚¹å‡»é¡µé¢ä»»æ„ä½ç½®æ¿€æ´»éŸ³é¢‘ä¸Šä¸‹æ–‡

### 4. éŸ³è´¨è¾ƒå·®æˆ–æœ‰å»¶è¿Ÿ

**é—®é¢˜ï¼š** éŸ³é¢‘è´¨é‡ä¸ä½³æˆ–å»¶è¿Ÿæ˜æ˜¾

**è§£å†³æ–¹æ¡ˆï¼š**
- åˆ‡æ¢åˆ°"çœæµæ¨¡å¼"å‡å°‘å¸¦å®½å ç”¨
- æ£€æŸ¥ç½‘ç»œè¿æ¥è´¨é‡
- å…³é—­å…¶ä»–å ç”¨å¸¦å®½çš„åº”ç”¨
- å¦‚æœä½¿ç”¨æœ¬åœ° LiveKit Serverï¼Œç¡®è®¤æœåŠ¡å™¨æ€§èƒ½å……è¶³

### 5. å¼€å‘ç¯å¢ƒ CORS é”™è¯¯

**é—®é¢˜ï¼š** æ§åˆ¶å°æ˜¾ç¤º CORS ç›¸å…³é”™è¯¯

**è§£å†³æ–¹æ¡ˆï¼š**
- ç¡®è®¤ä½¿ç”¨çš„æ˜¯ `ws://localhost:7880` è€Œä¸æ˜¯ `wss://`
- æ£€æŸ¥ LiveKit Server æ˜¯å¦ä½¿ç”¨ `--dev` å‚æ•°å¯åŠ¨
- å¦‚æœä½¿ç”¨ LiveKit Cloudï¼Œç¡®è®¤åŸŸåå·²æ·»åŠ åˆ°å…è®¸åˆ—è¡¨

## ğŸ“š API å‚è€ƒ

### VoiceRoom ç»„ä»¶ Props

```typescript
interface VoiceRoomProps {
  roomName: string;        // æˆ¿é—´åç§°ï¼ˆå”¯ä¸€æ ‡è¯†ï¼‰
  participantName: string; // å‚ä¸è€…åç§°
  onDisconnect?: () => void; // æ–­å¼€è¿æ¥å›è°ƒ
}
```

### Token API è¯·æ±‚æ ¼å¼

```typescript
POST /api/livekit/token

Body:
{
  "roomName": "string",           // å¿…éœ€ï¼šæˆ¿é—´åç§°
  "participantName": "string",    // å¿…éœ€ï¼šå‚ä¸è€…åç§°
  "participantMetadata": {        // å¯é€‰ï¼šå‚ä¸è€…å…ƒæ•°æ®
    "avatar": "string",
    "joinedAt": "string"
  }
}

Response:
{
  "token": "string",              // JWT token
  "url": "string",                // WebSocket URL
  "roomName": "string",
  "participantName": "string"
}
```

## ğŸ” å®‰å…¨å»ºè®®

1. **ä¿æŠ¤ API å¯†é’¥**
   - æ°¸è¿œä¸è¦å°† `LIVEKIT_API_KEY` å’Œ `LIVEKIT_API_SECRET` æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶
   - ä½¿ç”¨ç¯å¢ƒå˜é‡å­˜å‚¨æ•æ„Ÿä¿¡æ¯
   - åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨å¼ºå¯†ç 

2. **Token éªŒè¯**
   - Token æœ‰æ•ˆæœŸè®¾ç½®ä¸º 24 å°æ—¶
   - å¯ä»¥æ ¹æ®éœ€è¦è°ƒæ•´ TTL
   - å»ºè®®å®ç°ç”¨æˆ·èº«ä»½éªŒè¯åå†ç”Ÿæˆ token

3. **æˆ¿é—´æƒé™**
   - å½“å‰é…ç½®å…è®¸æ‰€æœ‰å‚ä¸è€…å‘å¸ƒå’Œè®¢é˜…
   - å¯ä»¥æ ¹æ®ä¸šåŠ¡éœ€æ±‚è°ƒæ•´æƒé™è®¾ç½®
   - è€ƒè™‘å®ç°ä¸»æŒäºº/è§‚ä¼—è§’è‰²åŒºåˆ†

## ğŸ“– æ›´å¤šèµ„æº

- [LiveKit å®˜æ–¹æ–‡æ¡£](https://docs.livekit.io/)
- [LiveKit JavaScript SDK](https://docs.livekit.io/client-sdk-js/)
- [LiveKit Server éƒ¨ç½²æŒ‡å—](https://docs.livekit.io/deploy/)
- [WebRTC æœ€ä½³å®è·µ](https://webrtc.org/getting-started/overview)

## ğŸ¤ æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·ï¼š
1. æŸ¥çœ‹æœ¬æ–‡æ¡£çš„å¸¸è§é—®é¢˜éƒ¨åˆ†
2. æŸ¥é˜… LiveKit å®˜æ–¹æ–‡æ¡£
3. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯ä¿¡æ¯
4. è”ç³»å¼€å‘å›¢é˜Ÿ

---

**æ³¨æ„ï¼š** æœ¬é¡¹ç›®ä½¿ç”¨çš„æ˜¯ LiveKit å¼€æºç‰ˆæœ¬ï¼Œå•†ä¸šä½¿ç”¨è¯·éµå®ˆç›¸å…³è®¸å¯åè®®ã€‚



